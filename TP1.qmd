---
title: "1er Trabajo Práctico de Econometría"
author: "Mauro y Juan Camilo"
lang: es
editor: visual
format:
  pdf:
    include-in-header: 
      text: |
        \usepackage{typearea}
---

## Librerías

```{r}
#| output: false

library(tidyverse)    #Para manejar bases de datos
library(ggplot2)      #Para graficar
library(eph)          #Librería hecha por científicos argentinos
library(tinytable)    #Para las tablas
library(modelsummary) #Mejores tablas de regresión 
```

```{r}
#| include: false

options(tinytable_tt_digits = 3)
options(tinytable_theme_placement_latex_float = "H")
```

```{r}
#| include: false

df <- get_microdata(year = 2023, trimester = 4, type = 'individual')
# %>% 
# organize_labels(type='individual') 
```

```{r}
#| include: false

df <- df %>% mutate_at(vars(NIVEL_ED, AGLOMERADO, CH07, ESTADO, REGION), ~as.factor(.))
```

Nos quedamos únicamente con los jefes de hogar, hombres, con edades entre 25 y 65 años, ocupados y asalariados.

```{r}
#| output: false

df <- df %>% 
  filter(CH03 == 1,           #Jefes/as de hogar
         CH04 == 1,           #Hombres          
         CH06 >= 25,          #Entre 25...      
         CH06 <= 65,          #...y 65 años     
         ESTADO == 1,         #Ocupados         
         CAT_OCUP == 3,       #Asalariados      
         P21 > 0,             #Salario positivo 
         CH12 < 9             #¬Educación espec.
         )
```

Habría que mencionar algo sobre la base resultante y un mínimo análisis exploratorio.

```{r}

df <- df %>%
  mutate(CH14 = case_when(
    CH13 != 2 ~ 0
    )
  )
```

```{r}
# Generación de la variable de años de educación
df <- df %>%
  mutate(ult_anio = as.numeric(CH14)) %>%
  mutate(ANIOS_ED = case_when(
    CH12 == 2 ~ ult_anio,             # Primario
    CH12 == 3 ~ ult_anio,             # EGB
    CH12 == 4 ~ (7 + ult_anio),       # Secundario
    CH12 == 5 ~ (9 + ult_anio),       # Polimodal
    CH12 == 6 ~ (12 + ult_anio),      # Terciario
    CH12 == 7 ~ (12 + ult_anio),      # Universitario
    CH12 == 8 ~ (12 + ult_anio),      # Posgrado Univ.
    TRUE ~ 0
  ))

#Cuadrado de los años de educación
df <- df %>% 
  mutate(ANIOS_ED_SQ = (ANIOS_ED)^2)

#Logaritmo del Salario
df <- df %>% 
  mutate(logSal = log(df$P21)
  )

```

```{r}
# library(plotly)
# 
# # Create a histogram for the CH12 column
# fig <- plot_ly(df, x = ~CH12, type = "histogram", histnorm = "probability",
#                marker = list(color = "#1f77b4"), opacity = 0.7) %>%
#        layout(title = "Distribution of Years of Education (CH12)",
#               xaxis = list(title = "Years of Education"),
#               yaxis = list(title = "Probability"))
# 
# # Show the plot
# fig

```

\newpage

\KOMAoptions{paper=landscape,pagesize}

\recalctypearea

En @tbl-mincer pueden leerse los resultados de la primer regresión.

```{r}
#| label: tbl-mincer
#| tbl-cap: "Ecuación de Mincer"
#| echo: false

reg1 <- lm(logSal ~ CH06 + NIVEL_ED + CH07 + AGLOMERADO, data = df)

reg2 <- lm(logSal ~ CH06 + NIVEL_ED + CH07 + REGION, data = df)

sum <- modelsummary(list("Por Aglomerado" = reg1,"Por Región" = reg2), width = 0.8, cap = "Juanca")

sum %>% 
  theme_tt("multipage", rowhead = 1)
```

\newpage

\KOMAoptions{paper=portrait,pagesize}

\recalctypearea
